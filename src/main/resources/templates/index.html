<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>主页面</title>
    <!-- 引入样式 -->
    <script type="text/javascript" src="../af/js/vue.js"></script>
    <script type="text/javascript" src="../af/js/axios.min.js"></script>

    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
</head>
<body>
<div id="app">
    <el-header>Header<span>王小虎</span></el-header>
    <el-container style="height: 890px; border: 1px solid #eee">
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)">
            <el-tree :data="dataTree" :props="defaultProps" @node-click="handleNodeClick"></el-tree>
        </el-aside>

        <el-main>
            <el-tabs v-model="editableTabsValue2" type="card" closable @tab-remove="removeTab">
                <el-tab-pane
                        v-for="(item, index) in editableTabs2"
                        :key="item.name"
                        :label="item.title"
                        :name="item.name"
                >
                    <div class="iframe-container">
                        <span v-html = "item.content"></span>
                    </div>
                </el-tab-pane>
            </el-tabs>
            <!--<div  style="border-radius:20px;">-->
                <!--<iframe  id="ifr" scrolling="auto" frameborder="0"  src="/af/add" style="width:100%;height:600px;margin-top: 20px;"></iframe>-->
            <!--</div>-->
        </el-main>
    </el-container>
</div>
<script>
var vm=new Vue({
    el: '#app',
    data: {
        dataTree: [],
        defaultProps: {
            children: 'children',
            label: 'lable'
        },
        editableTabsValue2: '2',
        editableTabs2:[],
        tabIndex: 2
    },
    created: function () {
        var self = this;
        //在 then的内部不能使用Vue的实例化的this, 因为在内部 this 没有被绑定。
        axios.post('/af/tree/list').then(function (response) {
            self.dataTree = response.data;
            //self.tags=response.data.label;
            alert(JSON.stringify(self.dataTree));
        })
    },
    methods: {
        addTab:function(content,title,targetName) {
            let newTabName = ++this.tabIndex + '';
            alert(content);
            this.editableTabs2.push({
                title: title,
                name: newTabName,
                content: content
            });
//            this.editableTabs2=[{
//                title: title,
//                name: newTabName,
//                content: content
//            }];
            this.editableTabsValue2 = newTabName;
        },

        removeTab:function(targetName) {
            let tabs = this.editableTabs2;
            let activeName = this.editableTabsValue2;
            if (activeName === targetName) {
                tabs.forEach((tab, index) => {
                    if (tab.name === targetName) {
                        let nextTab = tabs[index + 1] || tabs[index - 1];
                        if (nextTab) {
                            activeName = nextTab.name;
                        }
                    }
                });
            }

            this.editableTabsValue2 = activeName;
            this.editableTabs2 = tabs.filter(tab => tab.name !== targetName);
        },
        handleNodeClick:function(data) {
            alert(data.lable);
            var url = "http://localhost:8888"+data.treeUrl;
            var title = data.lable;
            alert(url);
            //var content = "<iframe src='"+url+"' width='100%' height='500' scrollin
            var content = "<iframe src='"+url+"' frameborder=\"no\" scrolling=\"no\"  style=\"width:100%;height:750px;\"> </iframe>";
            //var targetName = this.editableTabsValue2;
            var targetName = this.editableTabsValue2;
            this.addTab(content,title,targetName);
        }
    }
})
</script>
</body>
<style>
    .el-header {
        background-color: #203535;
        color: white;
        line-height: 60px;
    }

    .el-aside {
        color: #333;
    }

</style>
</html>